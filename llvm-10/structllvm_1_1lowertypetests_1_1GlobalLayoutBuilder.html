<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: llvm::lowertypetests::GlobalLayoutBuilder Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">10.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacellvm.html">llvm</a></li><li class="navelem"><a class="el" href="namespacellvm_1_1lowertypetests.html">lowertypetests</a></li><li class="navelem"><a class="el" href="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder.html">GlobalLayoutBuilder</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">llvm::lowertypetests::GlobalLayoutBuilder Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class implements a layout algorithm for globals referenced by bit sets that tries to keep members of small bit sets together.  
 <a href="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder.html#details">More...</a></p>

<p><code>#include &quot;<a class="el" href="LowerTypeTests_8h_source.html">llvm/Transforms/IPO/LowerTypeTests.h</a>&quot;</code></p>
<div class="dynheader">
Collaboration diagram for llvm::lowertypetests::GlobalLayoutBuilder:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder__coll__graph.svg" width="296" height="156"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2354a7882002ba4c12cd5f3be8dba7dd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder.html#a2354a7882002ba4c12cd5f3be8dba7dd">GlobalLayoutBuilder</a> (uint64_t NumObjects)</td></tr>
<tr class="separator:a2354a7882002ba4c12cd5f3be8dba7dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc53ed9289ca61898a56ea65b8a457db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder.html#abc53ed9289ca61898a56ea65b8a457db">addFragment</a> (<a class="el" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> std::set&lt; uint64_t &gt; &amp;<a class="el" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F</a>)</td></tr>
<tr class="memdesc:abc53ed9289ca61898a56ea65b8a457db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add F to the layout while trying to keep its indices contiguous.  <a href="#abc53ed9289ca61898a56ea65b8a457db">More...</a><br /></td></tr>
<tr class="separator:abc53ed9289ca61898a56ea65b8a457db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a5d2e54b342691d69ccfc9e799d404668"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::vector&lt; uint64_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder.html#a5d2e54b342691d69ccfc9e799d404668">Fragments</a></td></tr>
<tr class="memdesc:a5d2e54b342691d69ccfc9e799d404668"><td class="mdescLeft">&#160;</td><td class="mdescRight">The computed layout.  <a href="#a5d2e54b342691d69ccfc9e799d404668">More...</a><br /></td></tr>
<tr class="separator:a5d2e54b342691d69ccfc9e799d404668"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3e6889c1625ade2687b7fee501f64be"><td class="memItemLeft" align="right" valign="top">std::vector&lt; uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structllvm_1_1lowertypetests_1_1GlobalLayoutBuilder.html#ad3e6889c1625ade2687b7fee501f64be">FragmentMap</a></td></tr>
<tr class="memdesc:ad3e6889c1625ade2687b7fee501f64be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mapping from object index to fragment index.  <a href="#ad3e6889c1625ade2687b7fee501f64be">More...</a><br /></td></tr>
<tr class="separator:ad3e6889c1625ade2687b7fee501f64be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class implements a layout algorithm for globals referenced by bit sets that tries to keep members of small bit sets together. </p>
<p>This can significantly reduce bit set sizes in many cases.</p>
<p>It works by assembling fragments of layout from sets of referenced globals. Each set of referenced globals causes the algorithm to create a new fragment, which is assembled by appending each referenced global in the set into the fragment. If a referenced global has already been referenced by an fragment created earlier, we instead delete that fragment and append its contents into the fragment we are assembling.</p>
<p>By starting with the smallest fragments, we minimize the size of the fragments that are copied into larger fragments. This is most intuitively thought about when considering the case where the globals are virtual tables and the bit sets represent their derived classes: in a single inheritance hierarchy, the optimum layout would involve a depth-first search of the class hierarchy (and in fact the computed layout ends up looking a lot like a DFS), but a naive DFS would not work well in the presence of multiple inheritance. This aspect of the algorithm ends up fitting smaller hierarchies inside larger ones where that would be beneficial.</p>
<p>For example, consider this class hierarchy:</p>
<p>A B \ / | \ C D E</p>
<p>We have five bit sets: bsA (A, C), bsB (B, C, D, E), bsC (C), bsD (D) and bsE (E). If we laid out our objects by DFS traversing B followed by A, our layout would be {B, C, D, E, A}. This is optimal for bsB as it needs to cover the only 4 objects in its hierarchy, but not for bsA as it needs to cover 5 objects, i.e. the entire layout. Our algorithm proceeds as follows:</p>
<p>Add bsC, fragments {{C}} Add bsD, fragments {{C}, {D}} Add bsE, fragments {{C}, {D}, {E}} Add bsA, fragments {{A, C}, {D}, {E}} Add bsB, fragments {{B, A, C, D, E}}</p>
<p>This layout is optimal for bsA, as it now only needs to cover two (i.e. 3 fewer) objects, at the cost of bsB needing to cover 1 more object.</p>
<p>The bit set lowering pass assigns an object index to each object that needs to be laid out, and calls addFragment for each bit set passing the object indices of its referenced globals. It then assembles a layout from the computed layout in the Fragments field. </p>

<p class="definition">Definition at line <a class="el" href="LowerTypeTests_8h_source.html#l00126">126</a> of file <a class="el" href="LowerTypeTests_8h_source.html">LowerTypeTests.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2354a7882002ba4c12cd5f3be8dba7dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2354a7882002ba4c12cd5f3be8dba7dd">&#9670;&nbsp;</a></span>GlobalLayoutBuilder()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">llvm::lowertypetests::GlobalLayoutBuilder::GlobalLayoutBuilder </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>NumObjects</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="LowerTypeTests_8h_source.html#l00134">134</a> of file <a class="el" href="LowerTypeTests_8h_source.html">LowerTypeTests.h</a>.</p>

<p class="reference">References <a class="el" href="LLParser_8cpp.html#a33ece1ef8074506a15d7f86eb76dbae6">F()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="abc53ed9289ca61898a56ea65b8a457db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc53ed9289ca61898a56ea65b8a457db">&#9670;&nbsp;</a></span>addFragment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GlobalLayoutBuilder::addFragment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="AArch64PromoteConstant_8cpp.html#a90f8350fecae261c25be85d38b451bff">const</a> std::set&lt; uint64_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>F</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add F to the layout while trying to keep its indices contiguous. </p>
<p>If a previously seen fragment uses any of F's indices, that fragment will be laid out inside F. </p>

<p class="definition">Definition at line <a class="el" href="LowerTypeTests_8cpp_source.html#l00182">182</a> of file <a class="el" href="LowerTypeTests_8cpp_source.html">LowerTypeTests.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="LowerTypeTests_8cpp_source.html#l01332">selectJumpTableArmEncoding()</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ad3e6889c1625ade2687b7fee501f64be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3e6889c1625ade2687b7fee501f64be">&#9670;&nbsp;</a></span>FragmentMap</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;uint64_t&gt; llvm::lowertypetests::GlobalLayoutBuilder::FragmentMap</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mapping from object index to fragment index. </p>

<p class="definition">Definition at line <a class="el" href="LowerTypeTests_8h_source.html#l00132">132</a> of file <a class="el" href="LowerTypeTests_8h_source.html">LowerTypeTests.h</a>.</p>

</div>
</div>
<a id="a5d2e54b342691d69ccfc9e799d404668"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d2e54b342691d69ccfc9e799d404668">&#9670;&nbsp;</a></span>Fragments</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::vector&lt;uint64_t&gt; &gt; llvm::lowertypetests::GlobalLayoutBuilder::Fragments</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The computed layout. </p>
<p>Each element of this vector contains a fragment of layout (which may be empty) consisting of object indices. </p>

<p class="definition">Definition at line <a class="el" href="LowerTypeTests_8h_source.html#l00129">129</a> of file <a class="el" href="LowerTypeTests_8h_source.html">LowerTypeTests.h</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li>include/llvm/Transforms/IPO/<a class="el" href="LowerTypeTests_8h_source.html">LowerTypeTests.h</a></li>
<li>lib/Transforms/IPO/<a class="el" href="LowerTypeTests_8cpp_source.html">LowerTypeTests.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 24 2020 13:23:51 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
