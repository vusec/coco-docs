<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Transforms/Utils/CallPromotionUtils.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">10.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_a72932e0778af28115095468f6286ff8.html">Transforms</a></li><li class="navelem"><a class="el" href="dir_f75c00afeb315f44d76556a7c675e6e8.html">Utils</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">CallPromotionUtils.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="CallPromotionUtils_8h_source.html">llvm/Transforms/Utils/CallPromotionUtils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="IRBuilder_8h_source.html">llvm/IR/IRBuilder.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="BasicBlockUtils_8h_source.html">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for CallPromotionUtils.cpp:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="CallPromotionUtils_8cpp__incl.svg" width="6910" height="1038"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="CallPromotionUtils_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad78e062f62e0d6e453941fb4ca843e4d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CallPromotionUtils_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>&#160;&#160;&#160;&quot;call-promotion-utils&quot;</td></tr>
<tr class="separator:ad78e062f62e0d6e453941fb4ca843e4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a51ff57d75f102e980e39535df6ff00bb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CallPromotionUtils_8cpp.html#a51ff57d75f102e980e39535df6ff00bb">fixupPHINodeForNormalDest</a> (<a class="el" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *Invoke, <a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OrigBlock, <a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *MergeBlock)</td></tr>
<tr class="memdesc:a51ff57d75f102e980e39535df6ff00bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fix-up phi nodes in an invoke instruction's normal destination.  <a href="#a51ff57d75f102e980e39535df6ff00bb">More...</a><br /></td></tr>
<tr class="separator:a51ff57d75f102e980e39535df6ff00bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59b92d3bbd9b21b61a2afbb73c10c3b0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CallPromotionUtils_8cpp.html#a59b92d3bbd9b21b61a2afbb73c10c3b0">fixupPHINodeForUnwindDest</a> (<a class="el" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *Invoke, <a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *OrigBlock, <a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ThenBlock, <a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *ElseBlock)</td></tr>
<tr class="memdesc:a59b92d3bbd9b21b61a2afbb73c10c3b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fix-up phi nodes in an invoke instruction's unwind destination.  <a href="#a59b92d3bbd9b21b61a2afbb73c10c3b0">More...</a><br /></td></tr>
<tr class="separator:a59b92d3bbd9b21b61a2afbb73c10c3b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdf3ba57973320bd702d3b12b0b8fa8c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CallPromotionUtils_8cpp.html#abdf3ba57973320bd702d3b12b0b8fa8c">createRetPHINode</a> (<a class="el" href="classllvm_1_1Instruction.html">Instruction</a> *OrigInst, <a class="el" href="classllvm_1_1Instruction.html">Instruction</a> *NewInst, <a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *MergeBlock, <a class="el" href="classllvm_1_1IRBuilder.html">IRBuilder</a>&lt;&gt; &amp;Builder)</td></tr>
<tr class="memdesc:abdf3ba57973320bd702d3b12b0b8fa8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a phi node for the returned value of a call or invoke instruction.  <a href="#abdf3ba57973320bd702d3b12b0b8fa8c">More...</a><br /></td></tr>
<tr class="separator:abdf3ba57973320bd702d3b12b0b8fa8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af141a32fffe302081727f8bcc6665655"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CallPromotionUtils_8cpp.html#af141a32fffe302081727f8bcc6665655">createRetBitCast</a> (<a class="el" href="classllvm_1_1CallSite.html">CallSite</a> CS, <a class="el" href="classllvm_1_1Type.html">Type</a> *RetTy, <a class="el" href="classllvm_1_1CastInst.html">CastInst</a> **RetBitCast)</td></tr>
<tr class="memdesc:af141a32fffe302081727f8bcc6665655"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cast a call or invoke instruction to the given type.  <a href="#af141a32fffe302081727f8bcc6665655">More...</a><br /></td></tr>
<tr class="separator:af141a32fffe302081727f8bcc6665655"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a557002eb7cf295b3fbab8ad872dc278e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classllvm_1_1Instruction.html">Instruction</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CallPromotionUtils_8cpp.html#a557002eb7cf295b3fbab8ad872dc278e">versionCallSite</a> (<a class="el" href="classllvm_1_1CallSite.html">CallSite</a> CS, <a class="el" href="classllvm_1_1Value.html">Value</a> *<a class="el" href="AMDGPULibCalls_8cpp.html#a537c835c34f0b44b6ad2696643754390">Callee</a>, <a class="el" href="classllvm_1_1MDNode.html">MDNode</a> *BranchWeights)</td></tr>
<tr class="memdesc:a557002eb7cf295b3fbab8ad872dc278e"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classPredicate.html">Predicate</a> and clone the given call site.  <a href="#a557002eb7cf295b3fbab8ad872dc278e">More...</a><br /></td></tr>
<tr class="separator:a557002eb7cf295b3fbab8ad872dc278e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad78e062f62e0d6e453941fb4ca843e4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad78e062f62e0d6e453941fb4ca843e4d">&#9670;&nbsp;</a></span>DEBUG_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_TYPE&#160;&#160;&#160;&quot;call-promotion-utils&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="CallPromotionUtils_8cpp_source.html#l00020">20</a> of file <a class="el" href="CallPromotionUtils_8cpp_source.html">CallPromotionUtils.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="af141a32fffe302081727f8bcc6665655"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af141a32fffe302081727f8bcc6665655">&#9670;&nbsp;</a></span>createRetBitCast()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void createRetBitCast </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1CallSite.html">CallSite</a>&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Type.html">Type</a> *&#160;</td>
          <td class="paramname"><em>RetTy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1CastInst.html">CastInst</a> **&#160;</td>
          <td class="paramname"><em>RetBitCast</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cast a call or invoke instruction to the given type. </p>
<p>When promoting a call site, the return type of the call site might not match that of the callee. If this is the case, we have to cast the returned value to the correct type. The location of the cast depends on if we have a call or invoke instruction.</p>
<p>For example, if the call instruction below requires a bitcast after promotion:</p>
<p>orig_bb: t0 = call i32 () ...</p>
<p>The bitcast is placed after the call instruction:</p>
<p>orig_bb: ; Uses of the original return value are replaced by uses of the bitcast. t0 = call i32 () t1 = bitcast i32 t0 to ... ...</p>
<p>A similar transformation is performed for invoke instructions. However, since invokes are terminating, a new block is created for the bitcast. For example, if the invoke instruction below requires a bitcast after promotion:</p>
<p>orig_bb: t0 = invoke i32 () to label normal_dst unwind label unwind_dst</p>
<p>The edge between the original block and the invoke's normal destination is split, and the bitcast is placed there:</p>
<p>orig_bb: t0 = invoke i32 () to label split_bb unwind label unwind_dst</p>
<p>split_bb: ; Uses of the original return value are replaced by uses of the bitcast. t1 = bitcast i32 t0 to ... br label normal_dst </p>

<p class="definition">Definition at line <a class="el" href="CallPromotionUtils_8cpp_source.html#l00161">161</a> of file <a class="el" href="CallPromotionUtils_8cpp_source.html">CallPromotionUtils.cpp</a>.</p>

<p class="reference">References <a class="el" href="Instructions_8cpp_source.html#l02892">llvm::CastInst::CreateBitOrPointerCast()</a>, <a class="el" href="CallSite_8h_source.html#l00096">llvm::CallSiteBase&lt; FunTy, BBTy, ValTy, UserTy, UseTy, InstrTy, CallTy, InvokeTy, CallBrTy, IterTy &gt;::getInstruction()</a>, <a class="el" href="ilist__node_8h_source.html#l00081">llvm::ilist_node_impl&lt; OptionsT &gt;::getIterator()</a>, <a class="el" href="SmallVector_8h_source.html#l00211">llvm::SmallVectorTemplateBase&lt; T &gt;::push_back()</a>, <a class="el" href="User_8cpp_source.html#l00020">llvm::User::replaceUsesOfWith()</a>, <a class="el" href="BasicBlockUtils_8cpp_source.html#l00474">llvm::SplitEdge()</a>, and <a class="el" href="Value_8h_source.html#l00420">llvm::Value::users()</a>.</p>

<p class="reference">Referenced by <a class="el" href="CallPromotionUtils_8cpp_source.html#l00365">llvm::promoteCall()</a>.</p>

</div>
</div>
<a id="abdf3ba57973320bd702d3b12b0b8fa8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdf3ba57973320bd702d3b12b0b8fa8c">&#9670;&nbsp;</a></span>createRetPHINode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void createRetPHINode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Instruction.html">Instruction</a> *&#160;</td>
          <td class="paramname"><em>OrigInst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Instruction.html">Instruction</a> *&#160;</td>
          <td class="paramname"><em>NewInst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&#160;</td>
          <td class="paramname"><em>MergeBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1IRBuilder.html">IRBuilder</a>&lt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>Builder</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create a phi node for the returned value of a call or invoke instruction. </p>
<p>After versioning a call or invoke instruction that returns a value, we have to merge the value of the original and new instructions. We do this by creating a phi node and replacing uses of the original instruction with this phi node.</p>
<p>For example, if <code>OrigInst</code> is defined in "else_bb" and <code>NewInst</code> is defined in "then_bb", we create the following phi node:</p>
<p>; Uses of the original instruction are replaced by uses of the phi node. t0 = phi i32 [ orig_inst, else_bb ], [ new_inst, then_bb ], </p>

<p class="definition">Definition at line <a class="el" href="CallPromotionUtils_8cpp_source.html#l00104">104</a> of file <a class="el" href="CallPromotionUtils_8cpp_source.html">CallPromotionUtils.cpp</a>.</p>

<p class="reference">References <a class="el" href="Instructions_8h_source.html#l02704">llvm::PHINode::addIncoming()</a>, <a class="el" href="IRBuilder_8h_source.html#l02411">llvm::IRBuilder&lt; T, Inserter &gt;::CreatePHI()</a>, <a class="el" href="BasicBlock_8h_source.html#l00285">llvm::BasicBlock::front()</a>, <a class="el" href="IR_2Instruction_8h_source.html#l00066">llvm::Instruction::getParent()</a>, <a class="el" href="Value_8h_source.html#l00246">llvm::Value::getType()</a>, <a class="el" href="Type_8h_source.html#l00141">llvm::Type::isVoidTy()</a>, <a class="el" href="SmallVector_8h_source.html#l00211">llvm::SmallVectorTemplateBase&lt; T &gt;::push_back()</a>, <a class="el" href="IRBuilder_8h_source.html#l00132">llvm::IRBuilderBase::SetInsertPoint()</a>, <a class="el" href="Value_8h_source.html#l00343">llvm::Value::use_empty()</a>, and <a class="el" href="Value_8h_source.html#l00420">llvm::Value::users()</a>.</p>

</div>
</div>
<a id="a51ff57d75f102e980e39535df6ff00bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51ff57d75f102e980e39535df6ff00bb">&#9670;&nbsp;</a></span>fixupPHINodeForNormalDest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void fixupPHINodeForNormalDest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *&#160;</td>
          <td class="paramname"><em>Invoke</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&#160;</td>
          <td class="paramname"><em>OrigBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&#160;</td>
          <td class="paramname"><em>MergeBlock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fix-up phi nodes in an invoke instruction's normal destination. </p>
<p>After versioning an invoke instruction, values coming from the original block will now be coming from the "merge" block. For example, in the code below:</p>
<p>then_bb: t0 = invoke i32 ptr() to label merge_bb unwind label unwind_dst</p>
<p>else_bb: t1 = invoke i32 ptr() to label merge_bb unwind label unwind_dst</p>
<p>merge_bb: t2 = phi i32 [ t0, then_bb ], [ t1, else_bb ] br normal_dst</p>
<p>normal_dst: t3 = phi i32 [ x, orig_bb ], ...</p>
<p>"orig_bb" is no longer a predecessor of "normal_dst", so the phi nodes in "normal_dst" must be fixed to refer to "merge_bb":</p>
<p>normal_dst: t3 = phi i32 [ x, merge_bb ], ... </p>

<p class="definition">Definition at line <a class="el" href="CallPromotionUtils_8cpp_source.html#l00047">47</a> of file <a class="el" href="CallPromotionUtils_8cpp_source.html">CallPromotionUtils.cpp</a>.</p>

<p class="reference">References <a class="el" href="Instructions_8h_source.html#l03846">llvm::InvokeInst::getNormalDest()</a>, and <a class="el" href="BasicBlock_8h_source.html#l00329">llvm::BasicBlock::phis()</a>.</p>

</div>
</div>
<a id="a59b92d3bbd9b21b61a2afbb73c10c3b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59b92d3bbd9b21b61a2afbb73c10c3b0">&#9670;&nbsp;</a></span>fixupPHINodeForUnwindDest()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void fixupPHINodeForUnwindDest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1InvokeInst.html">InvokeInst</a> *&#160;</td>
          <td class="paramname"><em>Invoke</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&#160;</td>
          <td class="paramname"><em>OrigBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&#160;</td>
          <td class="paramname"><em>ThenBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1BasicBlock.html">BasicBlock</a> *&#160;</td>
          <td class="paramname"><em>ElseBlock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fix-up phi nodes in an invoke instruction's unwind destination. </p>
<p>After versioning an invoke instruction, values coming from the original block will now be coming from either the "then" block or the "else" block. For example, in the code below:</p>
<p>then_bb: t0 = invoke i32 ptr() to label merge_bb unwind label unwind_dst</p>
<p>else_bb: t1 = invoke i32 ptr() to label merge_bb unwind label unwind_dst</p>
<p>unwind_dst: t3 = phi i32 [ x, orig_bb ], ...</p>
<p>"orig_bb" is no longer a predecessor of "unwind_dst", so the phi nodes in "unwind_dst" must be fixed to refer to "then_bb" and "else_bb":</p>
<p>unwind_dst: t3 = phi i32 [ x, then_bb ], [ x, else_bb ], ... </p>

<p class="definition">Definition at line <a class="el" href="CallPromotionUtils_8cpp_source.html#l00078">78</a> of file <a class="el" href="CallPromotionUtils_8cpp_source.html">CallPromotionUtils.cpp</a>.</p>

<p class="reference">References <a class="el" href="Instructions_8h_source.html#l03849">llvm::InvokeInst::getUnwindDest()</a>, and <a class="el" href="BasicBlock_8h_source.html#l00329">llvm::BasicBlock::phis()</a>.</p>

</div>
</div>
<a id="a557002eb7cf295b3fbab8ad872dc278e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a557002eb7cf295b3fbab8ad872dc278e">&#9670;&nbsp;</a></span>versionCallSite()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classllvm_1_1Instruction.html">Instruction</a>* versionCallSite </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classllvm_1_1CallSite.html">CallSite</a>&#160;</td>
          <td class="paramname"><em>CS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1Value.html">Value</a> *&#160;</td>
          <td class="paramname"><em>Callee</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classllvm_1_1MDNode.html">MDNode</a> *&#160;</td>
          <td class="paramname"><em>BranchWeights</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="classPredicate.html">Predicate</a> and clone the given call site. </p>
<p>This function creates an if-then-else structure at the location of the call site. The "if" condition compares the call site's called value to the given callee. The original call site is moved into the "else" block, and a clone of the call site is placed in the "then" block. The cloned instruction is returned.</p>
<p>For example, the call instruction below:</p>
<p>orig_bb: t0 = call i32 ptr() ...</p>
<p>Is replace by the following:</p>
<p>orig_bb: cond = icmp eq i32 ()* ptr,  br i1 cond, then_bb, else_bb</p>
<p>then_bb: ; The clone of the original call instruction is placed in the "then" ; block. It is not yet promoted. t1 = call i32 ptr() br merge_bb</p>
<p>else_bb: ; The original call instruction is moved to the "else" block. t0 = call i32 ptr() br merge_bb</p>
<p>merge_bb: ; Uses of the original call instruction are replaced by uses of the phi ; node. t2 = phi i32 [ t0, else_bb ], [ t1, then_bb ] ...</p>
<p>A similar transformation is performed for invoke instructions. However, since invokes are terminating, more work is required. For example, the invoke instruction below:</p>
<p>orig_bb: t0 = invoke ptr() to label normal_dst unwind label unwind_dst</p>
<p>Is replace by the following:</p>
<p>orig_bb: cond = icmp eq i32 ()* ptr,  br i1 cond, then_bb, else_bb</p>
<p>then_bb: ; The clone of the original invoke instruction is placed in the "then" ; block, and its normal destination is set to the "merge" block. It is ; not yet promoted. t1 = invoke i32 ptr() to label merge_bb unwind label unwind_dst</p>
<p>else_bb: ; The original invoke instruction is moved into the "else" block, and ; its normal destination is set to the "merge" block. t0 = invoke i32 ptr() to label merge_bb unwind label unwind_dst</p>
<p>merge_bb: ; Uses of the original invoke instruction are replaced by uses of the ; phi node, and the merge block branches to the normal destination. t2 = phi i32 [ t0, else_bb ], [ t1, then_bb ] br normal_dst </p>

<p class="definition">Definition at line <a class="el" href="CallPromotionUtils_8cpp_source.html#l00256">256</a> of file <a class="el" href="CallPromotionUtils_8cpp_source.html">CallPromotionUtils.cpp</a>.</p>

<p class="reference">References <a class="el" href="CallSite_8h_source.html#l00104">llvm::CallSiteBase&lt; FunTy, BBTy, ValTy, UserTy, UseTy, InstrTy, CallTy, InvokeTy, CallBrTy, IterTy &gt;::getCalledValue()</a>, <a class="el" href="CallSite_8h_source.html#l00096">llvm::CallSiteBase&lt; FunTy, BBTy, ValTy, UserTy, UseTy, InstrTy, CallTy, InvokeTy, CallBrTy, IterTy &gt;::getInstruction()</a>, and <a class="el" href="Value_8h_source.html#l00246">llvm::Value::getType()</a>.</p>

<p class="reference">Referenced by <a class="el" href="CallPromotionUtils_8cpp_source.html#l00449">llvm::promoteCallWithIfThenElse()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 24 2020 13:16:04 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
