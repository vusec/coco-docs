<!DOCTYPE html><html><head><meta charset="utf-8"></meta><meta content="width=device-width, initial-scale=1" name="viewport"></meta><title>class CodeExtractor: LLVM 10.0.0 documentation</title><link href="styles.css" rel="stylesheet"></link><script src="highlight.min.js"></script><script>hljs.highlightAll();</script><link href="katex.min.css" rel="stylesheet"></link><script src="katex.min.js"></script><script src="auto-render.min.js"></script><script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false},
        ],
      });
    });
  </script><link href="apple-touch-icon.png" sizes="180x180" rel="apple-touch-icon"></link><link href="favicon-32x32.png" sizes="32x32" type="image/png" rel="icon"></link><link href="favicon-16x16.png" sizes="16x16" type="image/png" rel="icon"></link></head><body><div id="wrapper"><section class="section"><div class="container"><div class="columns"><aside class="column is-one-fifth"><ul class="menu-list"><p class="is-size-4">LLVM 10.0.0</p><p class="menu-label">Navigation</p><li><a href="index.html">Home</a></li><li><a href="search.html">Search</a></li><li><a href="https://github.com/llvm/llvm-project/">Repository</a></li><li><a href="https://hdoc.io">Made with hdoc</a></li><p class="menu-label">API Documentation</p><li><a href="functions.html">Functions</a></li><li><a href="records.html">Records</a></li><li><a href="enums.html">Enums</a></li><li><a href="namespaces.html">Namespaces</a></li></ul></aside><div class="column" style="overflow-x: auto"><nav class="breadcrumb has-arrow-separator" aria-label="breadcrumbs"><ul><li><a href="namespaces.html#00A4DA910CC17C2D"><span>namespace llvm</span></a></li><li class="is-active"><a aria-current="pageC287ED19C1E9C62B"><span>class CodeExtractor</span></a></li></ul></nav><main class="content"><h1>class CodeExtractor</h1><h2>Declaration</h2><pre class="p-0"><code class="hdoc-record-code language-cpp">class CodeExtractor { /* full declaration omitted */ };</code></pre><h2>Description</h2><p>Utility class for extracting code into a new function. This utility provides a simple interface for extracting some sequence of code into its own function, replacing it with a call to that function. It also provides various methods to query about the nature and result of such a transformation. The rough algorithm used is: 1) Find both the inputs and outputs for the extracted region. 2) Pass the inputs as arguments, remapping them within the extracted function to arguments. 3) Add allocas for any scalar outputs, adding all of the outputs&apos; allocas as arguments, and inserting stores to the arguments for any scalars.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L85">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:85</a></p><h2>Method Overview</h2><ul><li class="is-family-code">public  <a href="#79B26141F1C46AE1"><b>CodeExtractor</b></a>(ArrayRef&lt;llvm::BasicBlock *&gt; BBs, llvm::DominatorTree * DT = nullptr, bool AggregateArgs = false, llvm::BlockFrequencyInfo * BFI = nullptr, llvm::BranchProbabilityInfo * BPI = nullptr, llvm::AssumptionCache * AC = nullptr, bool AllowVarArgs = false, bool AllowAlloca = false, std::string Suffix = &quot;&quot;)</li><li class="is-family-code">public  <a href="#3F2168FEF6AD7DA0"><b>CodeExtractor</b></a>(llvm::DominatorTree &amp; DT, llvm::Loop &amp; L, bool AggregateArgs = false, llvm::BlockFrequencyInfo * BFI = nullptr, llvm::BranchProbabilityInfo * BPI = nullptr, llvm::AssumptionCache * AC = nullptr, std::string Suffix = &quot;&quot;)</li><li class="is-family-code">public llvm::Function *  <a href="#CE2057222CE76778"><b>extractCodeRegion</b></a>(const llvm::CodeExtractorAnalysisCache &amp; CEAC)</li><li class="is-family-code">public void  <a href="#1E116C95C1943046"><b>findAllocas</b></a>(const llvm::CodeExtractorAnalysisCache &amp; CEAC, llvm::CodeExtractor::ValueSet &amp; SinkCands, llvm::CodeExtractor::ValueSet &amp; HoistCands, llvm::BasicBlock *&amp; ExitBlock) const</li><li class="is-family-code">public void  <a href="#A058E54D1FF092A0"><b>findInputsOutputs</b></a>(llvm::CodeExtractor::ValueSet &amp; Inputs, llvm::CodeExtractor::ValueSet &amp; Outputs, const llvm::CodeExtractor::ValueSet &amp; Allocas) const</li><li class="is-family-code">public llvm::BasicBlock *  <a href="#A81123C9E3CF7AAE"><b>findOrCreateBlockForHoisting</b></a>(llvm::BasicBlock * CommonExitBlock)</li><li class="is-family-code">public bool  <a href="#21A06A7A6038ED1D"><b>isEligible</b></a>() const</li><li class="is-family-code">public bool  <a href="#39E3FF298CE6BBD8"><b>isLegalToShrinkwrapLifetimeMarkers</b></a>(const llvm::CodeExtractorAnalysisCache &amp; CEAC, llvm::Instruction * AllocaAddr) const</li><li class="is-family-code">public static bool  <a href="#5C9C091A837C0E94"><b>verifyAssumptionCache</b></a>(const llvm::Function &amp; F, llvm::AssumptionCache * AC)</li></ul><h2>Methods</h2><h3 id="79B26141F1C46AE1"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#79B26141F1C46AE1">¶</a><code class="hdoc-function-code language-cpp">CodeExtractor(
    <a href="r88137505AF2B6C74.html">ArrayRef</a>&lt;llvm::BasicBlock*&gt; BBs,
    <a href="r597D5CB55B73E338.html">llvm::DominatorTree</a>* DT = nullptr,
    bool AggregateArgs = false,
    <a href="r499F3CE9244F5224.html">llvm::BlockFrequencyInfo</a>* BFI = nullptr,
    <a href="r866F9A78FF13C61E.html">llvm::BranchProbabilityInfo</a>* BPI = nullptr,
    <a href="r53E6B995390ACBF6.html">llvm::AssumptionCache</a>* AC = nullptr,
    bool AllowVarArgs = false,
    bool AllowAlloca = false,
    <a href="https://en.cppreference.com/w/cpp/string/basic_string">std::string</a> Suffix = &quot;&quot;)</code></pre></h3><h4>Description</h4><p>Create a code extractor for a sequence of blocks. Given a sequence of basic blocks where the first block in the sequence dominates the rest, prepare a code extractor object for pulling this sequence out into its new function. When a DominatorTree is also given, extra checking and transformations are enabled. If AllowVarArgs is true, vararg functions can be extracted. This is safe, if all vararg handling code is extracted, including vastart. If AllowAlloca is true, then extraction of blocks containing alloca instructions would be possible, however code extractor won&apos;t validate whether extraction is legal.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L119">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:119</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="r88137505AF2B6C74.html">ArrayRef</a>&lt;llvm::BasicBlock*&gt;<b> BBs</b></dt><dt class="is-family-code"><a href="r597D5CB55B73E338.html">llvm::DominatorTree</a>*<b> DT</b> = nullptr</dt><dt class="is-family-code">bool<b> AggregateArgs</b> = false</dt><dt class="is-family-code"><a href="r499F3CE9244F5224.html">llvm::BlockFrequencyInfo</a>*<b> BFI</b> = nullptr</dt><dt class="is-family-code"><a href="r866F9A78FF13C61E.html">llvm::BranchProbabilityInfo</a>*<b> BPI</b> = nullptr</dt><dt class="is-family-code"><a href="r53E6B995390ACBF6.html">llvm::AssumptionCache</a>*<b> AC</b> = nullptr</dt><dt class="is-family-code">bool<b> AllowVarArgs</b> = false</dt><dt class="is-family-code">bool<b> AllowAlloca</b> = false</dt><dt class="is-family-code"><a href="https://en.cppreference.com/w/cpp/string/basic_string">std::string</a><b> Suffix</b> = &quot;&quot;</dt></dl><h3 id="3F2168FEF6AD7DA0"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#3F2168FEF6AD7DA0">¶</a><code class="hdoc-function-code language-cpp">CodeExtractor(
    <a href="r597D5CB55B73E338.html">llvm::DominatorTree</a>&amp; DT,
    <a href="r210AF08D1E341AC3.html">llvm::Loop</a>&amp; L,
    bool AggregateArgs = false,
    <a href="r499F3CE9244F5224.html">llvm::BlockFrequencyInfo</a>* BFI = nullptr,
    <a href="r866F9A78FF13C61E.html">llvm::BranchProbabilityInfo</a>* BPI = nullptr,
    <a href="r53E6B995390ACBF6.html">llvm::AssumptionCache</a>* AC = nullptr,
    <a href="https://en.cppreference.com/w/cpp/string/basic_string">std::string</a> Suffix = &quot;&quot;)</code></pre></h3><h4>Description</h4><p>Create a code extractor for a loop body. Behaves just like the generic code sequence constructor, but uses the block sequence of the loop.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L130">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:130</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="r597D5CB55B73E338.html">llvm::DominatorTree</a>&amp;<b> DT</b></dt><dt class="is-family-code"><a href="r210AF08D1E341AC3.html">llvm::Loop</a>&amp;<b> L</b></dt><dt class="is-family-code">bool<b> AggregateArgs</b> = false</dt><dt class="is-family-code"><a href="r499F3CE9244F5224.html">llvm::BlockFrequencyInfo</a>*<b> BFI</b> = nullptr</dt><dt class="is-family-code"><a href="r866F9A78FF13C61E.html">llvm::BranchProbabilityInfo</a>*<b> BPI</b> = nullptr</dt><dt class="is-family-code"><a href="r53E6B995390ACBF6.html">llvm::AssumptionCache</a>*<b> AC</b> = nullptr</dt><dt class="is-family-code"><a href="https://en.cppreference.com/w/cpp/string/basic_string">std::string</a><b> Suffix</b> = &quot;&quot;</dt></dl><h3 id="CE2057222CE76778"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#CE2057222CE76778">¶</a><code class="hdoc-function-code language-cpp"><a href="rADBA2A8E0906EC47.html">llvm::Function</a>* extractCodeRegion(
    const <a href="rE6B4EDE12FE92AC2.html">llvm::CodeExtractorAnalysisCache</a>&amp; CEAC)</code></pre></h3><h4>Description</h4><p>Perform the extraction, returning the new function. Returns zero when called on a CodeExtractor instance where isEligible returns false.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L140">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:140</a></p><h4>Parameters</h4><dl><dt class="is-family-code">const <a href="rE6B4EDE12FE92AC2.html">llvm::CodeExtractorAnalysisCache</a>&amp;<b> CEAC</b></dt></dl><h3 id="1E116C95C1943046"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#1E116C95C1943046">¶</a><code class="hdoc-function-code language-cpp">void findAllocas(
    const <a href="rE6B4EDE12FE92AC2.html">llvm::CodeExtractorAnalysisCache</a>&amp; CEAC,
    <a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp; SinkCands,
    <a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp; HoistCands,
    llvm::BasicBlock*&amp; ExitBlock) const</code></pre></h3><h4>Description</h4><p>Find the set of allocas whose life ranges are contained within the outlined region. Allocas which have life_time markers contained in the outlined region should be pushed to the outlined function. The address bitcasts that are used by the lifetime markers are also candidates for shrink- wrapping. The instructions that need to be sunk are collected in &apos;Allocas&apos;.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L183">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:183</a></p><h4>Parameters</h4><dl><dt class="is-family-code">const <a href="rE6B4EDE12FE92AC2.html">llvm::CodeExtractorAnalysisCache</a>&amp;<b> CEAC</b></dt><dt class="is-family-code"><a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp;<b> SinkCands</b></dt><dt class="is-family-code"><a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp;<b> HoistCands</b></dt><dt class="is-family-code">llvm::BasicBlock*&amp;<b> ExitBlock</b></dt></dl><h3 id="A058E54D1FF092A0"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#A058E54D1FF092A0">¶</a><code class="hdoc-function-code language-cpp">void findInputsOutputs(
    <a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp; Inputs,
    <a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp; Outputs,
    const <a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp; Allocas)
    const</code></pre></h3><h4>Description</h4><p>Compute the set of input values and output values for the code. These can be used either when performing the extraction or to evaluate the expected size of a call to the extracted function. Note that this work cannot be cached between the two as once we decide to extract a code sequence, that sequence is modified, including changing these sets, before extraction occurs. These modifications won&apos;t have any significant impact on the cost however.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L164">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:164</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp;<b> Inputs</b></dt><dt class="is-family-code"><a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp;<b> Outputs</b></dt><dt class="is-family-code">const <a href="r18A1C594405B201A.html">llvm::CodeExtractor::ValueSet</a>&amp;<b> Allocas</b></dt></dl><h3 id="A81123C9E3CF7AAE"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#A81123C9E3CF7AAE">¶</a><code class="hdoc-function-code language-cpp"><a href="r5F23A6FBCC3A87BD.html">llvm::BasicBlock</a>* findOrCreateBlockForHoisting(
    <a href="r5F23A6FBCC3A87BD.html">llvm::BasicBlock</a>* CommonExitBlock)</code></pre></h3><h4>Description</h4><p>Find or create a block within the outline region for placing hoisted code. CommonExitBlock is block outside the outline region. It is the common successor of blocks inside the region. If there exists a single block inside the region that is the predecessor of CommonExitBlock, that block will be returned. Otherwise CommonExitBlock will be split and the original block will be added to the outline region.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L195">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:195</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="r5F23A6FBCC3A87BD.html">llvm::BasicBlock</a>*<b> CommonExitBlock</b></dt></dl><h3 id="21A06A7A6038ED1D"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#21A06A7A6038ED1D">¶</a><code class="hdoc-function-code language-cpp">bool isEligible() const</code></pre></h3><h4>Description</h4><p>Test whether this code extractor is eligible. Based on the blocks used when constructing the code extractor, determine whether it is eligible for extraction. Checks that varargs handling (with vastart and vaend) is only done in the outlined blocks.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L154">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:154</a></p><h3 id="39E3FF298CE6BBD8"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#39E3FF298CE6BBD8">¶</a><code class="hdoc-function-code language-cpp">bool isLegalToShrinkwrapLifetimeMarkers(
    const <a href="rE6B4EDE12FE92AC2.html">llvm::CodeExtractorAnalysisCache</a>&amp; CEAC,
    <a href="rE266D8602316BABC.html">llvm::Instruction</a>* AllocaAddr) const</code></pre></h3><h4>Description</h4><p>Check if life time marker nodes can be hoisted/sunk into the outline region. Returns true if it is safe to do the code motion.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L172">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:172</a></p><h4>Parameters</h4><dl><dt class="is-family-code">const <a href="rE6B4EDE12FE92AC2.html">llvm::CodeExtractorAnalysisCache</a>&amp;<b> CEAC</b></dt><dt class="is-family-code"><a href="rE266D8602316BABC.html">llvm::Instruction</a>*<b> AllocaAddr</b></dt></dl><h3 id="5C9C091A837C0E94"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#5C9C091A837C0E94">¶</a><code class="hdoc-function-code language-cpp">static bool verifyAssumptionCache(
    const <a href="rADBA2A8E0906EC47.html">llvm::Function</a>&amp; F,
    <a href="r53E6B995390ACBF6.html">llvm::AssumptionCache</a>* AC)</code></pre></h3><h4>Description</h4><p>Verify that assumption cache isn&apos;t stale after a region is extracted. Returns false when verifier finds errors. AssumptionCache is passed as parameter to make this function stateless.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Utils/CodeExtractor.h#L145">llvm/include/llvm/Transforms/Utils/CodeExtractor.h:145</a></p><h4>Parameters</h4><dl><dt class="is-family-code">const <a href="rADBA2A8E0906EC47.html">llvm::Function</a>&amp;<b> F</b></dt><dt class="is-family-code"><a href="r53E6B995390ACBF6.html">llvm::AssumptionCache</a>*<b> AC</b></dt></dl></main></div></div></div></section></div><footer class="footer"><p>Documentation for LLVM 10.0.0.</p><p>Generated by <a href="https://hdoc.io/">hdoc</a> version 1.4.0-hdocInternal on 2022-12-14T09:44:14 UTC.</p><p class="has-text-grey-light">19AD43E11B2996</p></footer></body></html>