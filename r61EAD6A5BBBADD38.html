<!DOCTYPE html><html><head><meta charset="utf-8"></meta><meta content="width=device-width, initial-scale=1" name="viewport"></meta><title>class MSFBuilder: LLVM 10.0.0 documentation</title><link href="styles.css" rel="stylesheet"></link><script src="highlight.min.js"></script><script>hljs.highlightAll();</script><link href="katex.min.css" rel="stylesheet"></link><script src="katex.min.js"></script><script src="auto-render.min.js"></script><script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false},
        ],
      });
    });
  </script><link href="apple-touch-icon.png" sizes="180x180" rel="apple-touch-icon"></link><link href="favicon-32x32.png" sizes="32x32" type="image/png" rel="icon"></link><link href="favicon-16x16.png" sizes="16x16" type="image/png" rel="icon"></link></head><body><div id="wrapper"><section class="section"><div class="container"><div class="columns"><aside class="column is-one-fifth"><ul class="menu-list"><p class="is-size-4">LLVM 10.0.0</p><p class="menu-label">Navigation</p><li><a href="index.html">Home</a></li><li><a href="search.html">Search</a></li><li><a href="https://github.com/llvm/llvm-project/">Repository</a></li><li><a href="https://hdoc.io">Made with hdoc</a></li><p class="menu-label">API Documentation</p><li><a href="functions.html">Functions</a></li><li><a href="records.html">Records</a></li><li><a href="enums.html">Enums</a></li><li><a href="namespaces.html">Namespaces</a></li></ul></aside><div class="column" style="overflow-x: auto"><nav class="breadcrumb has-arrow-separator" aria-label="breadcrumbs"><ul><li><a href="namespaces.html#00A4DA910CC17C2D"><span>namespace llvm</span></a></li><li><a href="namespaces.html#21F6D5C9851E51BF"><span>namespace msf</span></a></li><li class="is-active"><a aria-current="page61EAD6A5BBBADD38"><span>class MSFBuilder</span></a></li></ul></nav><main class="content"><h1>class MSFBuilder</h1><h2>Declaration</h2><pre class="p-0"><code class="hdoc-record-code language-cpp">class MSFBuilder { /* full declaration omitted */ };</code></pre><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L26">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:26</a></p><h2>Method Overview</h2><ul><li class="is-family-code">public Expected&lt;uint32_t&gt;  <a href="#9427E35D54130632"><b>addStream</b></a>(uint32_t Size, ArrayRef&lt;uint32_t&gt; Blocks)</li><li class="is-family-code">public Expected&lt;uint32_t&gt;  <a href="#232F2F061FE593AB"><b>addStream</b></a>(uint32_t Size)</li><li class="is-family-code">public Expected&lt;llvm::FileBufferByteStream&gt;  <a href="#0666297E28765483"><b>commit</b></a>(llvm::StringRef Path, llvm::msf::MSFLayout &amp; Layout)</li><li class="is-family-code">public static Expected&lt;llvm::msf::MSFBuilder&gt;  <a href="#7F98FF4685DB0F3B"><b>create</b></a>(llvm::BumpPtrAllocator &amp; Allocator, uint32_t BlockSize, uint32_t MinBlockCount = 0, bool CanGrow = true)</li><li class="is-family-code">public Expected&lt;llvm::msf::MSFLayout&gt;  <a href="#FE93A11CD841411B"><b>generateLayout</b></a>()</li><li class="is-family-code">public llvm::BumpPtrAllocator &amp;  <a href="#1FD5BF2A53D69FEC"><b>getAllocator</b></a>()</li><li class="is-family-code">public uint32_t  <a href="#F25B26F42C8D1DBE"><b>getNumFreeBlocks</b></a>() const</li><li class="is-family-code">public uint32_t  <a href="#4D0893F771858D1E"><b>getNumStreams</b></a>() const</li><li class="is-family-code">public uint32_t  <a href="#120C9BD4E3C8B360"><b>getNumUsedBlocks</b></a>() const</li><li class="is-family-code">public ArrayRef&lt;uint32_t&gt;  <a href="#C079BEBF02A82A56"><b>getStreamBlocks</b></a>(uint32_t StreamIdx) const</li><li class="is-family-code">public uint32_t  <a href="#278539952659D672"><b>getStreamSize</b></a>(uint32_t StreamIdx) const</li><li class="is-family-code">public uint32_t  <a href="#2315FFBD5E023127"><b>getTotalBlockCount</b></a>() const</li><li class="is-family-code">public bool  <a href="#02DC14D4C95E051A"><b>isBlockFree</b></a>(uint32_t Idx) const</li><li class="is-family-code">public llvm::Error  <a href="#42FBA36187ABAFC6"><b>setBlockMapAddr</b></a>(uint32_t Addr)</li><li class="is-family-code">public llvm::Error  <a href="#91C63CBAB4FC27C3"><b>setDirectoryBlocksHint</b></a>(ArrayRef&lt;uint32_t&gt; DirBlocks)</li><li class="is-family-code">public void  <a href="#CE3002437E3020B7"><b>setFreePageMap</b></a>(uint32_t Fpm)</li><li class="is-family-code">public llvm::Error  <a href="#34922B3E0BA4CEF3"><b>setStreamSize</b></a>(uint32_t Idx, uint32_t Size)</li><li class="is-family-code">public void  <a href="#CD9E8E8FCFEFFB45"><b>setUnknown1</b></a>(uint32_t Unk1)</li></ul><h2>Methods</h2><h3 id="9427E35D54130632"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#9427E35D54130632">¶</a><code class="hdoc-function-code language-cpp"><a href="r004187BCD48C0729.html">Expected</a>&lt;uint32_t&gt; addStream(
    uint32_t Size,
    <a href="r88137505AF2B6C74.html">ArrayRef</a>&lt;uint32_t&gt; Blocks)</code></pre></h3><h4>Description</h4><p>Add a stream to the MSF file with the given size, occupying the given list of blocks.  This is useful when reading a MSF file and you want a particular stream to occupy the original set of blocks.  If the given blocks are already allocated, or if the number of blocks specified is incorrect for the given stream size, this function will return an Error.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L73">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:73</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> Size</b></dt><dt class="is-family-code"><a href="r88137505AF2B6C74.html">ArrayRef</a>&lt;uint32_t&gt;<b> Blocks</b></dt></dl><h3 id="232F2F061FE593AB"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#232F2F061FE593AB">¶</a><code class="hdoc-function-code language-cpp"><a href="r004187BCD48C0729.html">Expected</a>&lt;uint32_t&gt; addStream(uint32_t Size)</code></pre></h3><h4>Description</h4><p>Add a stream to the MSF file with the given size, occupying any available blocks that the builder decides to use.  This is useful when building a new PDB file from scratch and you don&apos;t care what blocks a stream occupies but you just want it to work.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L79">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:79</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> Size</b></dt></dl><h3 id="0666297E28765483"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#0666297E28765483">¶</a><code class="hdoc-function-code language-cpp"><a href="r004187BCD48C0729.html">Expected</a>&lt;llvm::FileBufferByteStream&gt; commit(
    <a href="rECFCAF624C04523A.html">llvm::StringRef</a> Path,
    <a href="r0B6A10E46F23AD11.html">llvm::msf::MSFLayout</a>&amp; Layout)</code></pre></h3><h4>Description</h4><p>Write the MSF layout to the underlying file.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L116">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:116</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="rECFCAF624C04523A.html">llvm::StringRef</a><b> Path</b></dt><dt class="is-family-code"><a href="r0B6A10E46F23AD11.html">llvm::msf::MSFLayout</a>&amp;<b> Layout</b></dt></dl><h3 id="7F98FF4685DB0F3B"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#7F98FF4685DB0F3B">¶</a><code class="hdoc-function-code language-cpp">static <a href="r004187BCD48C0729.html">Expected</a>&lt;llvm::msf::MSFBuilder&gt; create(
    <a href="r7A6342B286765F76.html">llvm::BumpPtrAllocator</a>&amp; Allocator,
    uint32_t BlockSize,
    uint32_t MinBlockCount = 0,
    bool CanGrow = true)</code></pre></h3><h4>Description</h4><p>Create a new `MSFBuilder`.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L56">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:56</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="r7A6342B286765F76.html">llvm::BumpPtrAllocator</a>&amp;<b> Allocator</b></dt><dt class="is-family-code">uint32_t<b> BlockSize</b></dt><dd>The internal block size used by the PDB file.  See isValidBlockSize() for a list of valid block sizes.</dd><dt class="is-family-code">uint32_t<b> MinBlockCount</b> = 0</dt><dd>Causes the builder to reserve up front space for at least `MinBlockCount` blocks.  This is useful when using `MSFBuilder` to read an existing MSF that you want to write back out later.  The original MSF file&apos;s SuperBlock contains the exact number of blocks used by the file, so is a good hint as to how many blocks the new MSF file will contain.  Furthermore, it is actually necessary in this case.  To preserve stability of the file&apos;s layout, it is helpful to try to keep all streams mapped to their original block numbers.  To ensure that this is possible, space for all blocks must be allocated beforehand so that streams can be assigned to them.</dd><dt class="is-family-code">bool<b> CanGrow</b> = true</dt><dd>If true, any operation which results in an attempt to locate a free block when all available blocks have been exhausted will allocate a new block, thereby growing the size of the final MSF file. When false, any such attempt will result in an error.  This is especially useful in testing scenarios when you know your test isn&apos;t going to do anything to increase the size of the file, so having an Error returned if it were to happen would catch a programming error</dd></dl><h4>Returns</h4><p>an llvm::Error representing whether the operation succeeded or failed.  Currently the only way this can fail is if an invalid block size is specified, or `MinBlockCount` does not leave enough room for the mandatory reserved blocks required by an MSF file.</p><h3 id="FE93A11CD841411B"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#FE93A11CD841411B">¶</a><code class="hdoc-function-code language-cpp"><a href="r004187BCD48C0729.html">Expected</a>&lt;llvm::msf::MSFLayout&gt; generateLayout()</code></pre></h3><h4>Description</h4><p>Finalize the layout and build the headers and structures that describe the MSF layout and can be written directly to the MSF file.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L113">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:113</a></p><h3 id="1FD5BF2A53D69FEC"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#1FD5BF2A53D69FEC">¶</a><code class="hdoc-function-code language-cpp"><a href="r7A6342B286765F76.html">llvm::BumpPtrAllocator</a>&amp; getAllocator()</code></pre></h3><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L118">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:118</a></p><h3 id="F25B26F42C8D1DBE"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#F25B26F42C8D1DBE">¶</a><code class="hdoc-function-code language-cpp">uint32_t getNumFreeBlocks() const</code></pre></h3><h4>Description</h4><p>Get the total number of blocks that exist in the MSF file but are not allocated to any valid data.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L102">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:102</a></p><h3 id="4D0893F771858D1E"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#4D0893F771858D1E">¶</a><code class="hdoc-function-code language-cpp">uint32_t getNumStreams() const</code></pre></h3><h4>Description</h4><p>Get the total number of streams in the MSF layout.  This should return 1 for every call to `addStream`.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L88">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:88</a></p><h3 id="120C9BD4E3C8B360"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#120C9BD4E3C8B360">¶</a><code class="hdoc-function-code language-cpp">uint32_t getNumUsedBlocks() const</code></pre></h3><h4>Description</h4><p>Get the total number of blocks that will be allocated to actual data in this MSF file.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L98">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:98</a></p><h3 id="C079BEBF02A82A56"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#C079BEBF02A82A56">¶</a><code class="hdoc-function-code language-cpp"><a href="r88137505AF2B6C74.html">ArrayRef</a>&lt;uint32_t&gt; getStreamBlocks(
    uint32_t StreamIdx) const</code></pre></h3><h4>Description</h4><p>Get the list of blocks allocated to a particular stream.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L94">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:94</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> StreamIdx</b></dt></dl><h3 id="278539952659D672"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#278539952659D672">¶</a><code class="hdoc-function-code language-cpp">uint32_t getStreamSize(uint32_t StreamIdx) const</code></pre></h3><h4>Description</h4><p>Get the size of a stream by index.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L91">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:91</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> StreamIdx</b></dt></dl><h3 id="2315FFBD5E023127"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#2315FFBD5E023127">¶</a><code class="hdoc-function-code language-cpp">uint32_t getTotalBlockCount() const</code></pre></h3><h4>Description</h4><p>Get the total number of blocks in the MSF file.  In practice this is equal to `getNumUsedBlocks() + getNumFreeBlocks()`.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L106">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:106</a></p><h3 id="02DC14D4C95E051A"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#02DC14D4C95E051A">¶</a><code class="hdoc-function-code language-cpp">bool isBlockFree(uint32_t Idx) const</code></pre></h3><h4>Description</h4><p>Check whether a particular block is allocated or free.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L109">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:109</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> Idx</b></dt></dl><h3 id="42FBA36187ABAFC6"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#42FBA36187ABAFC6">¶</a><code class="hdoc-function-code language-cpp"><a href="r40593E26768E0096.html">llvm::Error</a> setBlockMapAddr(uint32_t Addr)</code></pre></h3><h4>Description</h4><p>Request the block map to be at a specific block address.  This is useful when editing a MSF and you want the layout to be as stable as possible.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L63">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:63</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> Addr</b></dt></dl><h3 id="91C63CBAB4FC27C3"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#91C63CBAB4FC27C3">¶</a><code class="hdoc-function-code language-cpp"><a href="r40593E26768E0096.html">llvm::Error</a> setDirectoryBlocksHint(
    <a href="r88137505AF2B6C74.html">ArrayRef</a>&lt;uint32_t&gt; DirBlocks)</code></pre></h3><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L64">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:64</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="r88137505AF2B6C74.html">ArrayRef</a>&lt;uint32_t&gt;<b> DirBlocks</b></dt></dl><h3 id="CE3002437E3020B7"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#CE3002437E3020B7">¶</a><code class="hdoc-function-code language-cpp">void setFreePageMap(uint32_t Fpm)</code></pre></h3><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L65">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:65</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> Fpm</b></dt></dl><h3 id="34922B3E0BA4CEF3"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#34922B3E0BA4CEF3">¶</a><code class="hdoc-function-code language-cpp"><a href="r40593E26768E0096.html">llvm::Error</a> setStreamSize(uint32_t Idx,
                          uint32_t Size)</code></pre></h3><h4>Description</h4><p>Update the size of an existing stream.  This will allocate or deallocate blocks as needed to match the requested size.  This can fail if `CanGrow` was set to false when initializing the `MSFBuilder`.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L84">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:84</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> Idx</b></dt><dt class="is-family-code">uint32_t<b> Size</b></dt></dl><h3 id="CD9E8E8FCFEFFB45"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#CD9E8E8FCFEFFB45">¶</a><code class="hdoc-function-code language-cpp">void setUnknown1(uint32_t Unk1)</code></pre></h3><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h#L66">llvm/include/llvm/DebugInfo/MSF/MSFBuilder.h:66</a></p><h4>Parameters</h4><dl><dt class="is-family-code">uint32_t<b> Unk1</b></dt></dl></main></div></div></div></section></div><footer class="footer"><p>Documentation for LLVM 10.0.0.</p><p>Generated by <a href="https://hdoc.io/">hdoc</a> version 1.4.0-hdocInternal on 2022-12-14T09:44:14 UTC.</p><p class="has-text-grey-light">19AD43E11B2996</p></footer></body></html>