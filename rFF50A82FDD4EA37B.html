<!DOCTYPE html><html><head><meta charset="utf-8"></meta><meta content="width=device-width, initial-scale=1" name="viewport"></meta><title>struct SpeculateAroundPHIsPass: LLVM 10.0.0 documentation</title><link href="styles.css" rel="stylesheet"></link><script src="highlight.min.js"></script><script>hljs.highlightAll();</script><link href="katex.min.css" rel="stylesheet"></link><script src="katex.min.js"></script><script src="auto-render.min.js"></script><script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false},
        ],
      });
    });
  </script><link href="apple-touch-icon.png" sizes="180x180" rel="apple-touch-icon"></link><link href="favicon-32x32.png" sizes="32x32" type="image/png" rel="icon"></link><link href="favicon-16x16.png" sizes="16x16" type="image/png" rel="icon"></link></head><body><div id="wrapper"><section class="section"><div class="container"><div class="columns"><aside class="column is-one-fifth"><ul class="menu-list"><p class="is-size-4">LLVM 10.0.0</p><p class="menu-label">Navigation</p><li><a href="index.html">Home</a></li><li><a href="search.html">Search</a></li><li><a href="https://github.com/llvm/llvm-project/">Repository</a></li><li><a href="https://hdoc.io">Made with hdoc</a></li><p class="menu-label">API Documentation</p><li><a href="functions.html">Functions</a></li><li><a href="records.html">Records</a></li><li><a href="enums.html">Enums</a></li><li><a href="namespaces.html">Namespaces</a></li></ul></aside><div class="column" style="overflow-x: auto"><nav class="breadcrumb has-arrow-separator" aria-label="breadcrumbs"><ul><li><a href="namespaces.html#00A4DA910CC17C2D"><span>namespace llvm</span></a></li><li class="is-active"><a aria-current="pageFF50A82FDD4EA37B"><span>struct SpeculateAroundPHIsPass</span></a></li></ul></nav><main class="content"><h1>struct SpeculateAroundPHIsPass</h1><h2>Declaration</h2><pre class="p-0"><code class="hdoc-record-code language-cpp">struct SpeculateAroundPHIsPass : public PassInfoMixin { /* full declaration omitted */ };</code></pre><h2>Description</h2><p>This pass handles simple speculating of  instructions around PHIs when doing so is profitable for a particular target despite duplicated instructions. The motivating example are PHIs of constants which will require materializing the constants along each edge. If the PHI is used by an instruction where the target can materialize the constant as part of the instruction, it is profitable to speculate those instructions around the PHI node. This can reduce dynamic instruction count as well as decrease register pressure. Consider this IR for example: ``` entry: br i1 %flag, label %a, label %b a: br label %exit b: br label %exit exit: %p = phi i32 [ 7, %a ], [ 11, %b ] %sum = add i32 %arg, %p ret i32 %sum ``` To materialize the inputs to this PHI node may require an explicit instruction. For example, on x86 this would turn into something like ``` testq %eax, %eax movl $7, %rNN jne .L movl $11, %rNN .L: addl %edi, %rNN movl %rNN, %eax retq ``` When these constants can be folded directly into another instruction, it would be preferable to avoid the potential for register pressure (above we can easily avoid it, but that isn&apos;t always true) and simply duplicate the instruction using the PHI: ``` entry: br i1 %flag, label %a, label %b a: %sum.1 = add i32 %arg, 7 br label %exit b: %sum.2 = add i32 %arg, 11 br label %exit exit: %p = phi i32 [ %sum.1, %a ], [ %sum.2, %b ] ret i32 %p ``` Which will generate something like the following on x86: ``` testq %eax, %eax addl $7, %edi jne .L addl $11, %edi .L: movl %edi, %eax retq ``` It is important to note that this pass is never intended to handle more complex cases where speculating around PHIs allows simplifications of the IR itself or other subsequent optimizations. Those can and should already be handled before this pass is ever run by a more powerful analysis that can reason about equivalences and common subexpressions. Classically, those cases would be handled by a GVN-powered PRE or similar transform. This pass, in contrast, is *only* interested in cases where despite no simplifications to the IR itself, speculation is *faster* to execute. The result of this is that the cost models which are appropriate to consider here are relatively simple ones around execution and codesize cost, without any need to consider simplifications or other transformations.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Scalar/SpeculateAroundPHIs.h#L103">llvm/include/llvm/Transforms/Scalar/SpeculateAroundPHIs.h:103</a></p><p>Inherits from: PassInfoMixin</p><h2>Method Overview</h2><ul><li class="is-family-code">public llvm::PreservedAnalyses  <a href="#6D863488869AFC83"><b>run</b></a>(llvm::Function &amp; F, llvm::FunctionAnalysisManager &amp; AM)</li></ul><h2>Methods</h2><h3 id="6D863488869AFC83"><pre class="p-0 hdoc-pre-parent"><a class="hdoc-permalink-icon" href="#6D863488869AFC83">Â¶</a><code class="hdoc-function-code language-cpp"><a href="r9EDCE8A1E6A8CDD6.html">llvm::PreservedAnalyses</a> run(
    <a href="rADBA2A8E0906EC47.html">llvm::Function</a>&amp; F,
    <a href="rB9A0ED74935D969B.html">llvm::FunctionAnalysisManager</a>&amp; AM)</code></pre></h3><h4>Description</h4><p>Run the pass over the function.</p><p>Declared at: <a class="is-family-code" href="https://github.com/llvm/llvm-project/blob/release/10.x/llvm/include/llvm/Transforms/Scalar/SpeculateAroundPHIs.h#L105">llvm/include/llvm/Transforms/Scalar/SpeculateAroundPHIs.h:105</a></p><h4>Parameters</h4><dl><dt class="is-family-code"><a href="rADBA2A8E0906EC47.html">llvm::Function</a>&amp;<b> F</b></dt><dt class="is-family-code"><a href="rB9A0ED74935D969B.html">llvm::FunctionAnalysisManager</a>&amp;<b> AM</b></dt></dl></main></div></div></div></section></div><footer class="footer"><p>Documentation for LLVM 10.0.0.</p><p>Generated by <a href="https://hdoc.io/">hdoc</a> version 1.4.0-hdocInternal on 2022-12-14T09:44:14 UTC.</p><p class="has-text-grey-light">19AD43E11B2996</p></footer></body></html>